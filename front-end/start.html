<!DOCTYPE html>
<html>
  
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Start game</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous" />
    <link rel="stylesheet" type="text/css" href="styles/style.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"
      integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA=="
      crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  </head>

  <body class="d-flex flex-column align-items-center p-4" background="assets/sfondo_start.png">
    <button onclick="javascript:host(0,0,1)">logout</button>
    <!--FIXME fix leaveroom function, socket is create inside success ajax request, so it's unreachable-->
    <button onclick="javascript:leaveroom()">leaveroom</button>
    <!--<script type="text/javascript" charset="utf-8">
      var access_token = localStorage.getItem("ACCESS_TOKEN");
      
      data = { "n_round": 3, "n_pose": 5 };
      var socket = io.connect('https://strikeapose.it/', {
          extraHeaders: {
            Authorization: `Bearer ${access_token}`
          }
        });
    
      var success = function (room) {
        console.log(room)

        socket.on("status", (status) => {
          console.log("status: " + status.data);
        });

        socket.emit("join");

        socket.on("room_message", (msg) => {
          console.log("message from room: " + msg);
        });

        socket.on("message", (msg) => {
          console.log("message from server: " + msg);
        });
      }

      function logout() {
        $.ajax({
          url: "https://strikeapose.it/api/v1/logout",
          type: "post",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${access_token}`
          },
          success: (data) => {
            console.log(data);
            socket.emit("leave");
            //location.href = "/"
          },
          error: function (xhr, status, error) {
            console.log(error);
          }
        });

      }

      $.ajax({
        url: "https://strikeapose.it/api/v1/join/room",
        type: "post",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${access_token}`
        },
        data: JSON.stringify(data),
        dataType: "json",
        success: success,
        error: function (xhr, status, error) {
            console.log(error);
        }
      });
    </script>-->

    <img src="assets/logo.png" class="logo_mini" id="logo_start" />
    <div id="two-players">
      <div id="player-slider">
        <span>Player vs Player</span>
        <label class="switch">
          <input type="checkbox" id="show">
          <span class="slider round"></span>
        </label>
      </div>
      <form id="form" action="/action_page.php">
        <fieldset id="form_game">
          <label for="game">N°Round</label>
          <select name="rounds" id="rounds" autocomplete="off">
            <option value="1" selected>1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
          <br><br>
          <label for="Npose">N°Pose</label>
          <input type="number" id="Npose" name="Npose" min="1" max="6" value="1" autocomplete="off">
        </fieldset>
      </form>
    </div>
    <div id="level-list"></div>
  </body>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js"
    integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
  <script type="module" src="startModule.js"></script>
  <script type="text/javascript" src="start.js"></script>

</html>